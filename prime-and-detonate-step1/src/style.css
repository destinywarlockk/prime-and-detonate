@tailwind base;
@tailwind components;
@tailwind utilities;

/* === CONSOLIDATED BUTTON SYSTEM === */
.btn {
  /* Base button styles */
  min-height: 44px;
  padding: 10px 16px;
  font-size: 14px;
  font-weight: 600;
  border-radius: 8px;
  border: 1px solid transparent;
  touch-action: manipulation;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  text-decoration: none;
  white-space: nowrap;
  user-select: none;
  box-sizing: border-box;
  background: #1f2937;
  color: #e6ecf1;
  border-color: #1f2937;
}

.btn:hover:not(:disabled) {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.btn:active:not(:disabled) {
  transform: translateY(0);
}

.btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}

/* Button variants */
.btn--primary {
  background: #3b82f6;
  color: #ffffff;
  border-color: #3b82f6;
}

.btn--primary:hover:not(:disabled) {
  background: #2563eb;
  border-color: #2563eb;
}

.btn--secondary {
  background: #374151;
  color: #f8fafc;
  border: 1px solid #4b5563;
}

.btn--secondary:hover:not(:disabled) {
  background: #4b5563;
  border-color: #6b7280;
}

.btn--ghost {
  background: transparent;
  color: #e2e8f0;
  border-color: #374151;
}

.btn--ghost:hover:not(:disabled) {
  background: rgba(55, 65, 81, 0.5);
  border-color: #4b5563;
}

.btn--compact {
  min-height: 40px;
  padding: 8px 12px;
  font-size: 13px;
}

.btn--small {
  min-height: 36px;
  padding: 6px 10px;
  font-size: 12px;
}

.btn--tiny {
  min-height: 32px;
  padding: 5px 8px;
  font-size: 11px;
}

/* Special button types */
.btn-add-ability-compact {
  background: #059669;
  border-color: #10b981;
  color: #ffffff;
  font-weight: 600;
  min-height: 36px;
  min-width: 36px;
  padding: 8px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  line-height: 1;
}

.btn-add-ability-compact:hover:not(:disabled) {
  background: #047857;
  border-color: #059669;
}

.btn-add-ability-compact:disabled {
  background: #374151;
  border-color: #4b5563;
  color: #9ca3af;
  cursor: not-allowed;
}

.btn-remove-ability {
  background: #dc2626;
  border-color: #ef4444;
  color: #ffffff;
}

.btn-remove-ability:hover:not(:disabled) {
  background: #b91c1c;
  border-color: #dc2626;
}

/* Mobile responsive adjustments */
@media (max-width: 768px) {
  .btn {
    min-height: 40px;
    padding: 8px 12px;
    font-size: 13px;
  }
  
  .btn--compact {
    min-height: 36px;
    padding: 6px 10px;
    font-size: 12px;
  }
}

@media (max-width: 480px) {
  .btn {
    min-height: 36px;
    padding: 6px 10px;
    font-size: 12px;
  }
  
  .btn--compact {
    min-height: 32px;
    padding: 5px 8px;
    font-size: 11px;
  }
}

@media (max-width: 428px) {
  .btn {
    min-height: 32px;
    padding: 5px 8px;
    font-size: 11px;
  }
  
  .btn--compact {
    min-height: 28px;
    padding: 4px 6px;
    font-size: 10px;
  }
}

/* Touch device optimizations */
@media (pointer: coarse) {
  .btn {
    min-height: 44px;
  }
  
  .btn--compact {
    min-height: 40px;
  }
}

/* === CONSOLIDATED CARD SYSTEM === */
.card {
  /* Base card styles */
  background: #0e1420;
  border: 1px solid #1f2a3a;
  border-radius: 16px;
  padding: 14px;
  box-shadow: 0 6px 24px rgba(0, 0, 0, 0.3);
  position: relative;
  margin-bottom: 12px;
  transition: all 0.2s ease;
  box-sizing: border-box;
}

.card:hover {
  border-color: #3b82f6;
  background: #1a2332;
  cursor: pointer;
  transform: translateY(-2px);
  box-shadow: 0 8px 32px rgba(59, 130, 246, 0.2);
}

.card.is-selected {
  border-color: #10b981;
  background: #064e3b;
  box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
}

.card.is-dead {
  opacity: 0.6;
  background: #1a1a1a;
  border-color: #4a4a4a;
  filter: grayscale(0.8);
}

.card.is-disabled {
  opacity: 0.5;
  cursor: not-allowed;
  background: #1a1a1a;
}

.card.is-disabled:hover {
  transform: none;
  box-shadow: none;
}

/* Card variants */
.card--party {
  background: linear-gradient(135deg, #0e1420 0%, #1a2332 100%);
  border: 2px solid #1f2a3a;
}

.card--party.is-active {
  border-color: #3b82f6;
  background: linear-gradient(135deg, #1a2332 0%, #2d3748 100%);
  box-shadow: 0 8px 32px rgba(59, 130, 246, 0.3);
}

.card--compact {
  padding: 12px;
  margin-bottom: 8px;
  border-radius: 12px;
}

/* Mobile responsive adjustments */
@media (max-width: 768px) {
  .card {
    padding: 12px;
    margin-bottom: 10px;
  }
  
  .card--compact {
    padding: 10px;
    margin-bottom: 6px;
  }
}

@media (max-width: 480px) {
  .card {
    padding: 10px;
    margin-bottom: 8px;
  }
  
  .card--compact {
    padding: 8px;
    margin-bottom: 4px;
  }
}

@media (max-width: 428px) {
  .card {
    padding: 8px;
    margin-bottom: 6px;
  }
  
  .card--compact {
    padding: 6px;
    margin-bottom: 4px;
  }
}

/* === CONSOLIDATED ABILITY SYSTEM === */
.ability {
  /* Base ability styles */
  background: #0e1420;
  border: 1px solid #1f2a3a;
  border-radius: 12px;
  padding: 12px;
  text-align: left;
  cursor: pointer;
  transition: all 0.2s ease;
  min-height: 100px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  margin: 2px;
  box-sizing: border-box;
}

.ability:hover:not([disabled]):not(.is-disabled) {
  background: #121a28;
  border-color: #2a3650;
  transform: translateY(-1px);
}

.ability.is-selected {
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
  background: #0f1a2e;
  margin: 3px;
  transform: translateY(-1px);
}

.ability[disabled],
.ability[data-ok="false"],
.ability.is-disabled {
  opacity: 0.45;
  filter: saturate(0.7);
  cursor: not-allowed;
}

/* Ability type variants */
.ability--kinetic {
  box-shadow: inset 0 0 0 2px rgba(148, 163, 184, 0.25);
}

.ability--arc {
  box-shadow: inset 0 0 0 2px rgba(96, 165, 250, 0.25);
}

.ability--thermal {
  box-shadow: inset 0 0 0 2px rgba(251, 146, 60, 0.25);
}

.ability--void {
  box-shadow: inset 0 0 0 2px rgba(167, 139, 250, 0.25);
}

.ability--compact {
  min-height: 80px;
  padding: 10px;
  margin: 1px;
}

/* Mobile responsive adjustments */
@media (max-width: 768px) {
  .ability {
    padding: 10px;
    min-height: 90px;
  }
  
  .ability--compact {
    padding: 8px;
    min-height: 70px;
  }
}

@media (max-width: 480px) {
  .ability {
    padding: 8px;
    min-height: 80px;
  }
  
  .ability--compact {
    padding: 6px;
    min-height: 60px;
  }
}

html, body, #app { height: 100%; }

:root {
  --pad: 16px;
  --radius: 8px;
}

* { 
  box-sizing: border-box; 
}

html, body, #app { 
  height: 100%; 
  margin: 0; 
  background: #0b0f1a; 
  color: #e6ecf1; 
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif; 
  overflow-x: hidden; /* Prevent horizontal overflow */
  width: 100%;
}

/* iPhone specific viewport fixes */
@media screen and (max-width: 428px) {
  html, body, #app {
    width: 100vw;
    max-width: 100vw;
    overflow-x: hidden;
  }
  
  #app-wrap {
    width: 100vw;
    max-width: 100vw;
    overflow-x: hidden;
  }
}

/* Disable page scroll when applied (used by battle screen) */
html.no-scroll, body.no-scroll {
  overflow: hidden;
  position: fixed;
  width: 100%;
  height: 100%;
  overscroll-behavior: none;
}

#app-wrap { 
  touch-action: manipulation; 
  width: 100%;
  max-width: 100vw;
  overflow-x: hidden;
}

/* === LOADOUT SCREEN OPTIMIZATIONS === */

/* Loadout screen container */
.loadout-screen {
  max-width: 100vw;
  margin: 0;
  padding: 0;
  width: 100vw;
  height: 100vh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  box-sizing: border-box;
}

/* Scrollable content area */
.loadout-content {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  width: 100%;
  box-sizing: border-box;
  -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
  scroll-behavior: smooth;
  overscroll-behavior: contain; /* Prevent overscroll bounce */
}

/* Ability list container */
.ability-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
  width: 100%;
  box-sizing: border-box;
}

/* Compact ability cards */
.ability-card--compact {
  background: #0e1420;
  border: 1px solid #1f2a3a;
  border-radius: 12px;
  padding: 12px;
  gap: 8px;
  touch-action: manipulation;
  width: 100%;
  box-sizing: border-box;
  transition: all 0.2s ease;
  min-height: auto;
}

.ability-card--compact:hover {
  border-color: #3b82f6;
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
}

.ability-card--compact:active {
  transform: translateY(1px);
}

/* Action footer */
.action-footer {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 9999;
  background: #0b0f1a;
  padding: 16px max(12px, env(safe-area-inset-left)) 16px max(12px, env(safe-area-inset-right));
  padding-bottom: max(16px, calc(16px + env(safe-area-inset-bottom)));
  box-sizing: border-box;
  min-height: 150px;
  width: 100vw;
  max-width: 100vw;
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  box-shadow: 0 -4px 20px rgba(0,0,0,0.8);
}

/* Ensure footer is visible on all devices */
.action-footer::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: #0b0f1a;
  z-index: -1;
}

/* Debug styles removed */

/* Mobile-specific footer positioning - now handled by consolidated system above */

/* Ensure viewport height is properly set */
html, body {
  height: 100vh;
  height: -webkit-fill-available;
  overflow-x: hidden;
}

.loadout-screen {
  min-height: 100vh;
  min-height: -webkit-fill-available;
}

/* Footer actions grid */
.footer-actions {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr 1.3fr;
  gap: 10px;
  align-items: stretch;
  width: 100%;
}

/* Button optimizations for mobile - now handled by consolidated button system above */

/* Section spacing */
.section {
  margin-bottom: 20px;
  width: 100%;
  box-sizing: border-box;
}

.loadout-sub {
  margin-bottom: 10px;
  font-size: 15px;
  font-weight: 600;
  color: #e2e8f0;
}

/* Mobile optimizations now handled by consolidated responsive system above */

/* Mobile optimizations now handled by consolidated responsive system above */

/* === NEW DESTINY-INSPIRED UI SYSTEM === */

/* App container and header */
.app {
  min-height: 100vh;
  background: linear-gradient(135deg, #0a0f1a 0%, #1a2335 100%);
  color: #f8fafc;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

.header {
  padding: 20px;
  text-align: center;
  border-bottom: 1px solid #1f2a3a;
  background: rgba(8, 12, 20, 0.8);
  backdrop-filter: blur(8px);
}

.header .title {
  font-size: 24px;
  font-weight: 700;
  letter-spacing: 0.5px;
  color: #f8fafc;
  margin: 0;
}

/* Card clarity (party/enemy panels) - now handled by consolidated system above */

/* Party and enemy row layouts */
.party-row, .enemy-row {
  margin-bottom: 24px;
}

/* Move party section up by 20px */
.party-row {
  margin-top: -20px;
}

.party-row h2, .enemy-row h2 {
  font-size: 18px;
  font-weight: 600;
  color: #e2e8f0;
  margin: 0 0 16px 0;
  padding-left: 4px;
}

/* Party summary stats */
.party-summary {
  margin-bottom: 16px;
}

.party-stats {
  display: flex;
  gap: 24px;
  padding: 12px 16px;
  background: rgba(31, 41, 55, 0.3);
  border-radius: 12px;
  border: 1px solid #374151;
}

.party-stat {
  font-size: 14px;
  color: #9ca3af;
}

.party-stat strong {
  color: #e2e8f0;
  font-weight: 600;
}

/* Party health bar */
.party-health-bar {
  height: 8px;
  background: rgba(31, 41, 55, 0.5);
  border-radius: 4px;
  overflow: hidden;
  margin-top: 12px;
}

.health-bar-fill {
  height: 100%;
  background: linear-gradient(90deg, #10b981, #34d399);
  transition: width 0.3s ease;
}

.party-cards, .enemy-cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 16px;
  margin-bottom: 16px;
}

/* Party Member Card (mobile-first) */
.pm-card{display:flex;gap:12px;align-items:center;background:linear-gradient(180deg,#111a2b,#0f1a2c);border:1px solid #2b5cff66;border-radius:16px;padding:12px;width:100%;max-width:520px;box-shadow:0 0 0 3px #2b5cff22 inset}
.pm-avatar{width:68px;height:68px;border-radius:50%;opacity:.9;object-fit:cover}
.pm-main{flex:1;min-width:0}
.pm-top{display:flex;align-items:center;justify-content:space-between;gap:8px}
.pm-name{color:#e6eefc;font-weight:700;font-size:1rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.pm-badges{display:flex;gap:6px;flex-shrink:0}
.pm-pill{font-size:.72rem;line-height:1;padding:6px 8px;border-radius:999px;background:#1e2b44;color:#e6eefc;opacity:.9;white-space:nowrap}
.pm-status.pm-active{background:#16a34a;color:#fff}
.pm-status.pm-down{background:#ef4444;color:#fff}
.pm-role{color:#a7b3ca;font-size:.8rem;margin:2px 0 6px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.pm-stat{display:grid;grid-template-columns:24px 1fr;align-items:center;gap:6px;margin:6px 0}
.pm-label{color:#a7b3ca;font-size:.68rem;letter-spacing:.04em}
.pm-bar{position:relative;height:14px;border-radius:8px;background:#101828;padding-right:46px;overflow:hidden}
.pm-fill{position:absolute;left:0;top:0;bottom:0;width:0%;transition:width .25s ease;border-radius:8px}
.pm-fill.sh{background:#7aa2ff}
.pm-fill.hp{background:#3ad0a1}
.pm-fill.sp{background:#a477ff}
.pm-val{position:absolute;right:8px;top:50%;transform:translateY(-50%);font-size:.7rem;color:#eaf0ff;text-shadow:0 1px 2px #0008;pointer-events:none;white-space:nowrap}
@media (max-width:380px){.pm-card{padding:10px;border-radius:14px}.pm-avatar{width:60px;height:60px}.pm-pill{padding:5px 7px}.pm-bar{padding-right:40px;height:13px}.pm-val{font-size:.66rem;right:6px}}

/* Party card styles now handled by consolidated system above */

.party-card .character-class {
  font-size: 12px;
  font-weight: 600;
  color: #9ca3af;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-top: 4px;
}

.class-icon {
  width: 16px;
  height: 16px;
  object-fit: contain;
  vertical-align: -3px;
  margin-right: 6px;
  border-radius: 3px;
}

/* Status badges for party members */
.status-badge {
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  padding: 4px 8px;
  border-radius: 12px;
  margin-top: 8px;
  display: inline-block;
}

.status--active {
  background: #059669;
  color: #d1fae5;
  border: 1px solid #10b981;
}

.status--dead {
  background: #dc2626;
  color: #fecaca;
  border: 1px solid #ef4444;
}

/* No abilities message */
.no-abilities {
  text-align: center;
  padding: 40px 20px;
  background: rgba(31, 41, 55, 0.5);
  border-radius: 16px;
  border: 1px solid #374151;
}

.no-abilities-message h3 {
  color: #9ca3af;
  margin: 0 0 12px 0;
  font-size: 18px;
  font-weight: 600;
}

.no-abilities-message p {
  color: #6b7280;
  margin: 0;
  font-size: 14px;
}

/* Battle result overlay */
.battle-result-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.battle-result {
  background: linear-gradient(135deg, #0e1420 0%, #1a2332 100%);
  border: 2px solid #1f2a3a;
  border-radius: 20px;
  padding: 40px;
  text-align: center;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
}

.battle-result h2 {
  font-size: 32px;
  font-weight: 700;
  margin: 0 0 16px 0;
  color: #f8fafc;
}

.battle-result p {
  font-size: 18px;
  color: #9ca3af;
  margin: 0 0 32px 0;
}

.victory-narrative {
  margin: 0 0 32px 0;
}

.victory-text {
  font-size: 16px;
  line-height: 1.6;
  color: #d1d5db;
  font-style: italic;
  max-width: 500px;
  margin: 0 auto;
  padding: 20px;
  background: rgba(30, 41, 59, 0.3);
  border-radius: 12px;
  border: 1px solid rgba(148, 163, 184, 0.2);
}

/* Card interaction styles now handled by consolidated system above */

.card-head { 
  display: flex; 
  align-items: center; 
  justify-content: space-between; 
  margin-bottom: 10px; 
}

.card-head h3 { 
  margin: 0; 
  font-weight: 700; 
  letter-spacing: .3px; 
  color: #f8fafc;
  font-size: 16px;
}

.chips { 
  display: flex; 
  gap: 6px; 
  flex-wrap: wrap; 
}

.chip {
  font-size: 12px;
  padding: 8px 12px;
  border-radius: 999px;
  background: #111827;
  color: #c9d3e7;
  border: 1px solid #1f2937;
  font-weight: 600;
  min-height: 44px;
  display: inline-flex;
  align-items: center;
  cursor: pointer;
  user-select: none;
}

.chip.active { background:#1f2533; border-color:#334155; }
.chip--empty { opacity: .6; }

/* Mobile-first party selection layout */
.loadout-wrap { display:grid; gap:12px; padding:12px; }
.loadout-header { display:flex; justify-content:space-between; align-items:center; }
.loadout-sub { font-size:13px; opacity:.8; }

.filter-row { display:flex; gap:8px; overflow:auto; padding:4px 0; }

.card-grid { display:grid; gap:12px; grid-template-columns: 1fr; }
@media (min-width: 520px) { .card-grid { grid-template-columns: 1fr 1fr; } }
@media (min-width: 900px) { .card-grid { grid-template-columns: repeat(3, 1fr); } }

/* === PARTY CARD STYLES === */
.char-card {
  border: 1px solid #1f2937;
  border-radius: 14px;
  background: #0f172a;
  padding: 8px 8px 12px 8px;
  display: grid;
  grid-template-columns: 100px 1fr auto;
  gap: 6px;
  align-items: center;
  min-height: 64px;
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
  /* Allow selection outline to be visible */
  overflow: visible;
  min-width: 260px;
  /* Add margin to accommodate selection ring */
  margin: 2px;
}

/* Character info container */
.char-info {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  width: 100px;
  flex-shrink: 0;
}

.char-icon { 
  width: 100px; 
  min-height: 100px; 
  display: flex; 
  flex-direction: column;
  align-items: center; 
  justify-content: flex-start; 
  flex-shrink: 0;
  gap: 6px;
  padding-top: 8px;
}

.char-icon img { 
  width: 74px !important; 
  height: 74px !important; 
  object-fit: contain; 
  border-radius: 8px; 
  flex-shrink: 0;
  max-width: none !important;
  max-height: none !important;
}

.char-name { 
  white-space: nowrap; 
  overflow: hidden; 
  text-overflow: ellipsis; 
  font-weight: 800; 
  letter-spacing: .3px;
  font-size: 14px;
  text-align: center;
  color: #f8fafc;
}

.char-stats {
  display: flex;
  flex-direction: column;
  gap: 1px;
  min-width: 0;
  flex: 1;
}

/* Class pill container */
.class-pill {
  margin-bottom: 4px;
  text-align: left;
}

/* Ensure description text positioning works */
.class-description {
  margin-left: 0;
  padding-left: 0;
  text-align: left;
}

.description-text {
  margin-top: 4px;
  padding: 4px 8px;
  font-size: 0.75rem;
  font-style: italic;
  opacity: 0.6;
  color: #94a3b8;
  text-align: left;
}

.stat-row {
  font-size: 11px;
  opacity: 0.9;
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  align-items: flex-start;
  align-content: flex-start;
  justify-content: flex-start;
  text-align: left;
}

.stat {
  background: #0b1220;
  padding: 2px 5px;
  border-radius: 6px;
  white-space: nowrap;
}

/* Special styling for the class pill */
.class-pill .stat {
  background: linear-gradient(135deg, #1e293b, #334155);
  border: 1px solid #475569;
  padding: 4px 8px;
  font-weight: 700;
  color: #f8fafc;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  /* Remove full width constraint */
  width: fit-content;
  flex-basis: auto;
}

/* Element pill styling based on element type */
.element-kin {
  background: #64748b !important;
  border: 1px solid #94a3b8 !important;
  color: #f8fafc !important;
  font-weight: 700;
}

.element-arc {
  background: #0ea5e9 !important;
  border: 1px solid #38bdf8 !important;
  color: #f8fafc !important;
  font-weight: 700;
}

.element-thr {
  background: #f97316 !important;
  border: 1px solid #fb923c !important;
  color: #f8fafc !important;
  font-weight: 700;
}

.element-void {
  background: #a855f7 !important;
  border: 1px solid #c084fc !important;
  color: #f8fafc !important;
  font-weight: 700;
}

.loadout-sub {
  font-size: 12px;
  color: #9ca3af;
  opacity: 0.8;
  margin-top: 2px;
}

/* Super bar styling - 3 stages */
.super-bar {
  position: relative;
  height: 12px;
  border-radius: 4px;
  background: rgba(148, 163, 184, 0.15);
  margin: 4px 0;
  overflow: hidden;
  border: 1px solid rgba(148, 163, 184, 0.3);
}

.super-segments {
  display: flex;
  gap: 2px;
  height: 100%;
  padding: 1px;
}

.super-segment {
  flex: 1;
  border-radius: 2px;
  background: rgba(148, 163, 184, 0.2);
  transition: background 0.3s ease;
  min-height: 8px;
}

.super-segment[data-tier="1"] {
  background: rgba(148, 163, 184, 0.2);
}

.super-segment[data-tier="2"] {
  background: rgba(148, 163, 184, 0.2);
}

.super-segment[data-tier="3"] {
  background: rgba(148, 163, 184, 0.2);
}



/* Ensure party cards don't cause horizontal scroll */
.party-screen .card-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 12px;
  width: 100%;
  overflow-x: hidden;
  padding: 0 8px;
  /* Allow selection outlines to be visible */
  overflow: visible;
}

/* Mobile adjustments for party cards */
@media (max-width: 428px) {
  .char-card {
    min-width: 240px;
    padding: 6px 6px;
  }
  
  .party-screen .card-grid {
    gap: 8px;
    padding: 0 6px;
  }
}

@media (max-width: 375px) {
  .char-card {
    min-width: 220px;
    padding: 4px 4px;
  }
  
  .party-screen .card-grid {
    gap: 6px;
    padding: 0 4px;
  }
}

.super-bar-fill {
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  background: linear-gradient(90deg, #fbbf24, #f59e0b);
  border-radius: 4px;
  transition: width 0.3s ease;
  width: 0%;
  box-shadow: 0 0 8px rgba(251, 191, 36, 0.8);
  min-height: 16px;
  display: block;
  visibility: visible;
}

.char-icon { 
  width:48px; 
  height:48px; 
  display:flex; 
  align-items:center; 
  justify-content:center; 
  flex-shrink: 0;
}



.char-card.selected { 
  outline: 3px solid #3b82f6; 
  outline-offset: 2px;
  /* Ensure the selection ring is visible */
  position: relative;
  z-index: 1;
}



.slot-pill { 
  font-size:11px; 
  opacity:.85; 
}

.card-cta { 
  display:flex; 
  gap:6px; 
  justify-content: flex-end; 
  flex-shrink: 0;
}

.pick-btn { 
  min-height:40px; 
  padding:6px 10px; 
  border-radius:8px; 
  border:1px solid #3b82f6; 
  background:#3b82f6; 
  font-weight:700; 
  cursor:pointer; 
  font-size: 12px;
  white-space: nowrap;
  color: #ffffff;
}

.pick-btn[disabled] { 
  opacity:.5; 
  cursor:not-allowed; 
}

/* Mobile-specific adjustments for party cards */
@media (max-width: 480px) {
  .char-card {
    grid-template-columns: 80px 1fr auto;
    gap: 6px;
    padding: 10px 12px 14px 12px;
    min-height: 56px;
  }
  
  .char-info {
    width: 80px;
  }
  
  .char-icon {
    width: 80px;
    min-height: 80px;
  }
  
  .char-icon img {
    width: 62px !important;
    height: 62px !important;
  }
  
  .char-name {
    font-size: 13px;
  }
  
  .stat-row {
    font-size: 10px;
    gap: 6px;
  }
  
  .stat {
    padding: 1px 4px;
  }
  
  .pick-btn {
    min-height: 36px;
    padding: 5px 8px;
    font-size: 11px;
  }
}

@media (max-width: 428px) {
  .char-card {
    grid-template-columns: 70px 1fr auto;
    gap: 5px;
    padding: 8px 10px 12px 10px;
    min-height: 52px;
  }
  
  .char-info {
    width: 70px;
  }
  
  .char-icon {
    width: 70px;
    min-height: 70px;
  }
  
  .char-icon img {
    width: 62px !important;
    height: 62px !important;
  }
  
  .char-name {
    font-size: 12px;
  }
  
  .stat-row {
    font-size: 9px;
    gap: 4px;
  }
  
  .stat {
    padding: 1px 3px;
  }
  
  .pick-btn {
    min-height: 32px;
    padding: 4px 6px;
    font-size: 10px;
  }
}

.sticky-cta { position:sticky; bottom:0; background:#111827; border-top:1px solid #1f2937; padding:12px; display:flex; gap:12px; align-items:center; justify-content:space-between; }
.progress { font-size:14px; opacity:.9; }
.primary { min-height:48px; padding:12px 16px; border-radius:12px; border:1px solid #1f2937; background:#3b82f6; color:#0b0f1a; font-weight:800; cursor:pointer; }
.primary[disabled] { filter:grayscale(1); opacity:.6; cursor:not-allowed; }
.chip--burn { background: #3a1a10; border-color: #7a3a1c; color: #ffb38a; }
.chip--overload { background: #0e223b; border-color: #245a9b; color: #9cd2ff; }
.chip--suppress { background: #1b1230; border-color: #4b3a7a; color: #c9b5ff; }
.chip--weakpoint { background: #23282e; border-color: #3e4754; color: #d5dee7; }
.chip--freeze { background: #0e2a2f; border-color: #1e4a52; color: #7dd3fc; }

.meters label { 
  display: block; 
  font-size: 11px; 
  opacity: .7; 
  margin: 8px 0 4px; 
  color: #94a3b8;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-weight: 600;
}

/* Compact meters variant used on battle party cards */
.meters-compact label { margin: 0 0 2px; font-size: 10px; }

.meter { 
  position: relative; 
  height: 12px; 
  background: #172031; 
  border-radius: 8px; 
  overflow: hidden; 
  margin-bottom: 16px;
}

.meter > div { 
  height: 100%; 
  transition: width 0.4s ease;
  min-width: 3px;
}

.meter span { 
  position: absolute; 
  right: 6px; 
  top: -20px; 
  font-size: 11px; 
  opacity: .7; 
  color: #cbd5e1;
  font-weight: 600;
  background: #0e1420;
  padding: 1px 4px;
  border-radius: 3px;
  border: 1px solid #1f2a3a;
}

.meter--sh > div { background: linear-gradient(90deg,#3b82f6,#60a5fa); }
.meter--hp > div { background: linear-gradient(90deg,#34d399,#10b981); }
.meter--sp > div { background: linear-gradient(90deg,#a78bfa,#8b5cf6); }

/* 3) Ability tray = readable and scannable */
.ability-tabs { 
  display: flex; 
  gap: 8px; 
  margin: 10px 0; 
}

.tab { 
  height: 34px; 
  padding: 0 12px; 
  border-radius: 10px; 
  background: #0e1522; 
  border: 1px solid #253249; 
  color: #cbd5e1;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
}

.tab:hover:not(.is-active) {
  background: #121a28;
  border-color: #2a3650;
}

.tab.is-active { 
  border-color: #3b82f6; 
  box-shadow: 0 0 0 3px rgba(59,130,246,.15) inset; 
  color: #f8fafc;
}

.ability-tray {
  display: grid; 
  grid-template-columns: repeat(2, minmax(0,1fr));
  gap: 6px; 
  padding-bottom: 90px; /* space above bottom bar */
}

/* Ability styles now handled by consolidated system above */

.ability-header {
  margin-bottom: 8px;
}

.ability-name {
  display: block;
  font-weight: 600;
  font-size: 14px;
  color: #f8fafc;
  margin-bottom: 4px;
}

.ability-role { 
  display: block; 
  font-size: 11px; 
  opacity: .7; 
  color: #94a3b8;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-weight: 500;
}

.ability-effect {
  font-size: 12px;
  color: #cbd5e1;
  opacity: 0.9;
  line-height: 1.3;
  font-weight: 500;
}

/* Ability interaction styles now handled by consolidated system above */

/* 4) Combat log that auto-scrolls */
.log {
  background: #0e1420;
  border: 1px solid #1f2a3a;
  border-radius: 16px;
  padding: 12px;
  height: 96px; /* Increased to 4 lines */
  overflow: hidden; /* Don't scroll the outer container */
  margin-bottom: 16px;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 13px;
  line-height: 1.4;
  color: #cbd5e1;
}

.log-content {
  height: 100%;
  overflow-y: auto; /* Only the inner content scrolls */
  padding-right: 4px; /* Add some padding for scrollbar */
}

.log .row { 
  opacity: .9; 
  margin-bottom: 6px; 
  color: #cbd5e1;
}

.log .row .t { 
  opacity: .55; 
  margin-right: 6px; 
  color: #64748b;
}

/* 5) Bottom action bar (sticky, safe-area padding) */
.actionbar {
  position: fixed; 
  left: 0; 
  right: 0; 
  bottom: 0;
  padding: 12px calc(env(safe-area-inset-right, 12px)) calc(env(safe-area-inset-bottom, 12px) + 8px) calc(env(safe-area-inset-left, 12px));
  background: linear-gradient(180deg, rgba(8,12,20,0), rgba(8,12,20,.9) 28%);
  display: flex; 
  gap: 10px; 
  justify-content: center;
  backdrop-filter: saturate(1.2) blur(8px);
  z-index: 100;
}

.big {
  min-width: 150px; 
  height: 48px; 
  border-radius: 14px;
  background: #1a2335; 
  border: 1px solid #2a3650; 
  font-weight: 700;
  color: #f8fafc;
  cursor: pointer;
  transition: all 0.2s ease;
}

.big:hover:not(:disabled) {
  background: #1e293b;
  border-color: #334155;
  transform: translateY(-1px);
}

.big.ghost { 
  background: #0f1624; 
  border-color: #1f2a3a;
}

.big:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

/* 6) Ability preview card */
.preview {
  margin: 8px 0 12px; 
  padding: 10px 12px; 
  border-radius: 12px;
  background: #0c1322; 
  border: 1px solid #22304a; 
  font-size: 14px;
  color: #e2e8f0;
  font-weight: 500;
}

/* 7) Layout improvements */
.main {
  display: grid;
  grid-template-rows: auto auto auto auto 1fr auto;
  gap: 12px; 
  padding: 12px 12px 90px; /* bottom for action bar */
}

.row { 
  display: flex; 
  gap: 12px; 
  overflow: auto; 
  padding-bottom: 4px; 
}

.row::-webkit-scrollbar { 
  display: none; 
}

/* Clean up old conflicting styles */
.enemy-card, .barstack, .bar, .bar-label, .bar-bg, .bar-fill, .bar-value, .prime-badge, .target-controls, .btn-target, .target-info {
  /* These are now replaced by the new system */
}

.footer {
  display: grid;
  grid-template-columns: 1fr;
  gap: var(--pad);
  padding: var(--pad);
  background:#111827; border-top:1px solid #1f2937;
  flex-shrink: 0;
}

.arena { background:#0f172a; border:1px solid #1f2937; border-radius:var(--radius); display:flex; align-items:center; justify-content:center; }

.damage-types {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 8px;
  margin-bottom: 8px;
}

.btn-type {
  padding: 8px 6px; 
  border-radius: 8px; 
  border: 1px solid #1f2937; 
  background: #1f2937; 
  color: #e6ecf1;
  font-weight: 600; 
  text-align: center; 
  min-height: 36px; 
  user-select: none; 
  cursor: pointer;
  font-size: 12px;
  transition: all 150ms ease;
}

.btn-type:hover:not(:disabled) {
  background: #374151;
  border-color: #4b5563;
}

.btn-type.active {
  background: #3b82f6;
  border-color: #60a5fa;
  color: white;
}

.btn-type:disabled { 
  opacity: .5; 
  cursor: not-allowed; 
}

/* Button styles now handled by consolidated system above */

.actor {
  background:#0f172a; border:1px solid #1f2937; border-radius:var(--radius); padding: var(--pad);
}
.row {
  font-size: 12px; /* Reduced from 14px */
  color: #e5e7eb;
  margin-bottom: 4px; /* Reduced from 6px */
}

/* Clean actor name styling */
.row strong {
  font-size: 16px;
  font-weight: 700;
  color: #f8fafc;
  margin-bottom: 8px;
  display: block;
}

.abilities {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 8px;
  margin-bottom: 8px;
  max-height: 200px;
  overflow-y: auto;
}

.btn-ability {
  padding: 8px 12px;
  background: #374151;
  border: 1px solid #4b5563;
  border-radius: 6px;
  color: #e5e7eb;
  font-size: 11px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
  text-align: left;
  min-height: 60px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

.btn-ability:hover:not(:disabled) {
  background: #4b5563;
  border-color: #6b7280;
}

.btn-ability.active {
  background: #3b82f6;
  border-color: #60a5fa;
  color: white;
}

.btn-ability:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.ability-name {
  font-weight: 600;
  font-size: 12px;
  margin-bottom: 2px;
}

.ability-type {
  font-size: 10px;
  opacity: 0.8;
  font-weight: 500;
}

.ability-role {
  font-size: 10px;
  opacity: 0.6;
  font-style: italic;
}

.ability-class {
  font-size: 10px;
  opacity: 0.7;
  font-weight: 500;
  text-transform: capitalize;
  color: #a78bfa;
}

/* Clean health bar system */
.barstack {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-top: 12px;
}

.bar {
  height: 14px;
  border-radius: 7px;
  position: relative;
  overflow: visible;
  margin-bottom: 18px;
}

.bar-label {
  font-size: 11px;
  font-weight: 600;
  color: #94a3b8;
  margin-bottom: 4px;
  display: block;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.bar-bg {
  width: 100%;
  height: 100%;
  background: #334155;
  border-radius: 7px;
  position: relative;
  border: 1px solid #475569;
  box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3);
}

.bar-fill {
  height: 100%;
  border-radius: 7px;
  transition: width 0.4s ease;
  min-width: 3px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}

.bar-fill.sh {
  background: linear-gradient(90deg, #3b82f6, #60a5fa);
}

.bar-fill.hp {
  background: linear-gradient(90deg, #10b981, #34d399);
}

.bar-fill.sp {
  background: linear-gradient(90deg, #8b5cf6, #a78bfa);
}

.bar-value {
  position: absolute;
  right: 0;
  top: -18px;
  font-size: 10px;
  font-weight: 700;
  color: #f8fafc;
  background: #1e293b;
  padding: 2px 6px;
  border-radius: 4px;
  border: 1px solid #475569;
  white-space: nowrap;
  z-index: 5;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

/* Remove old primes styling that conflicts */
.primes {
  display: flex;
  gap: 4px;
  flex-wrap: wrap;
  margin-bottom: 8px;
}

.primes .prime {
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 10px;
  font-weight: 600;
  color: white;
}

.primes.weakpoint { background: #dc2626; }
.primes.overload { background: #2563eb; }
.primes.burn { background: #ea580c; }
.primes.suppress { background: #7c3aed; }
.primes.freeze { background: #0891b2; }

/* Enhanced prime badge styling for stacked primes */
.prime-badge {
  display: inline-flex;
  align-items: center;
  gap: 2px;
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 10px;
  font-weight: 600;
  color: white;
  position: relative;
  transition: all 0.2s ease;
}

.prime-badge.prime--kinetic { background: #64748b; }
.prime-badge.prime--arc { background: #0ea5e9; }
.prime-badge.prime--thermal { background: #f97316; }
.prime-badge.prime--void { background: #a855f7; }

/* Stacked prime styling */
.prime-badge.prime--stacked {
  background: linear-gradient(135deg, currentColor, rgba(255,255,255,0.2));
  box-shadow: 0 0 8px currentColor, inset 0 1px 0 rgba(255,255,255,0.3);
  transform: scale(1.05);
}

.prime-count {
  background: rgba(255,255,255,0.9);
  color: #1e293b;
  font-size: 8px;
  font-weight: 700;
  padding: 1px 3px;
  border-radius: 50%;
  min-width: 12px;
  height: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  line-height: 1;
}

/* Chip styling for legacy cards */
.chip {
  display: inline-flex;
  align-items: center;
  gap: 2px;
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 10px;
  font-weight: 600;
  color: white;
  position: relative;
}

.chip--kinetic { background: #64748b; }
.chip--arc { background: #0ea5e9; }
.chip--thermal { background: #f97316; }
.chip--void { background: #a855f7; }
.chip--empty { background: #475569; color: #94a3b8; }

.chip--stacked {
  background: linear-gradient(135deg, currentColor, rgba(255,255,255,0.2));
  box-shadow: 0 0 8px currentColor, inset 0 1px 0 rgba(255,255,255,0.3);
  transform: scale(1.05);
}

.chip-count {
  background: rgba(255,255,255,0.9);
  color: #1e293b;
  font-size: 8px;
  font-weight: 700;
  padding: 1px 3px;
  border-radius: 50%;
  min-width: 12px;
  height: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  line-height: 1;
}

.log-line {
  padding: 4px 0;
  border-bottom: 1px solid #374151;
  font-size: 13px;
  line-height: 1.4;
}

/* Player actions - green for positive outcomes */
.log .row.log-player-action { color: #10b981; font-weight: 500; }

/* Enemy actions - red for damage taken */
.log .row.log-enemy-action { color: #ef4444; font-weight: 500; }

/* Battle results - gold for victory/defeat */
.log .row.log-battle-result { color: #f59e0b; font-weight: 600; font-size: 14px; }

/* Info messages - blue for neutral information */
.log .row.log-info { color: #3b82f6; font-style: italic; }

/* Granular color coding for specific message types */
.log .row.log-dmg-out { color: #a7f3d0; }
.log .row.log-dmg-in  { color: #fecaca; }
.log .row.log-prime   { color: #93c5fd; }
.log .row.log-detonate{ color: #fbbf24; }
.log .row.log-explode { color: #f59e0b; font-weight: 700; }

/* Clean prime badge design */
.prime-badge {
  display: inline-block;
  background: #475569;
  color: #f8fafc;
  padding: 3px 8px;
  border-radius: 12px;
  font-size: 10px;
  font-weight: 600;
  margin-right: 6px;
  margin-bottom: 6px;
  border: 1px solid #64748b;
  text-transform: capitalize;
}

.prime-badge.weakpoint { background: #dc2626; border-color: #ef4444; }
.prime-badge.overload { background: #2563eb; border-color: #3b82f6; }
.prime-badge.burn { background: #ea580c; border-color: #f97316; }
.prime-badge.suppress { background: #7c3aed; border-color: #8b5cf6; }
.prime-badge.freeze { background: #0891b2; border-color: #06b6d4; }
.prime-badge.none { background: #6b7280; border-color: #9ca3af; }

/* === LOADOUT SCREEN STYLES === */
.loadout-screen {
  max-width: 100vw;
  margin: 0;
  padding: 0;
  width: 100vw;
  height: 100vh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  box-sizing: border-box;
}

/* Add proper padding to prevent cards from being cut off */
.loadout-wrap {
  padding: 0 max(16px, env(safe-area-inset-left)) 0 max(16px, env(safe-area-inset-right));
  flex: 1;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  width: 100%;
  box-sizing: border-box;
}

/* Main content area that should scroll */
.ability-assignment {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
  padding: 16px;
  box-sizing: border-box;
}

/* Character ability section container */
.character-ability-section {
  width: 100%;
  box-sizing: border-box;
}

/* Available abilities container */
.available-abilities {
  width: 100%;
  box-sizing: border-box;
  margin-bottom: 20px;
}

.available-abilities h4 {
  margin-bottom: 12px;
  color: #e2e8f0;
  font-size: 16px;
  font-weight: 600;
}

/* Ensure ability cards don't get cut off - now handled above */
.ability-grid.ability-grid--mobile {
  display: flex !important;
  flex-direction: row !important;
  gap: 10px; /* Increased from 8px for better readability */
  padding: 0 2px; /* Increased padding */
  width: 100%;
  box-sizing: border-box;
  overflow-x: auto;
  overflow-y: visible;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: thin;
  min-height: 100px; /* Ensure minimum height for scrolling */
  padding-bottom: 8px; /* Add bottom padding to show scrollbar */
  scroll-behavior: smooth; /* Smooth scrolling */
  overscroll-behavior-x: contain; /* Prevent horizontal overscroll */
}

/* Improve touch scrolling on mobile */
@media (pointer: coarse) {
  .ability-grid.ability-grid--mobile {
    scroll-snap-type: x proximity; /* Snap to cards when scrolling */
    scroll-padding: 0 10px; /* Add padding for snap points */
  }
  
  .ability-card--mobile {
    scroll-snap-align: start; /* Snap cards to start of container */
  }
}

/* Constrain element badge width to prevent it from extending too far */
.element-badge {
  max-width: 60px; /* Reduced to prevent overflow */
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  display: inline-block;
}

/* Button sizing now handled by consolidated system above */

/* Button styling now handled by consolidated system above */

/* Improve footer actions layout */
.footer-actions {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr 1.3fr; /* Adjusted for mobile */
  gap: 8px; /* Reduced gap */
  align-items: stretch;
  width: 100%;
}

/* Ensure ability cards don't get cut off - now handled above */

/* Improve section spacing */
.section {
  margin-bottom: 20px; /* Increased from 16px for better separation */
  width: 100%;
  box-sizing: border-box;
}

/* Ensure proper spacing around the footer */
.sticky-footer {
  position: sticky; 
  bottom: 0; 
  z-index: 40; 
  display: flex; 
  align-items: center; 
  justify-content: space-between; 
  padding: 12px max(16px, env(safe-area-inset-left)) 12px max(16px, env(safe-area-inset-right)); /* Safe area aware */
  background: rgba(8,12,20,0.95); 
  backdrop-filter: blur(8px);
  margin: 0; /* Remove negative margins */
  width: 100%; /* Full width */
  gap: 12px; /* Reduced gap */
  flex-direction: column;
  box-sizing: border-box;
  padding-bottom: max(12px, calc(12px + env(safe-area-inset-bottom))); /* Safe area bottom */
}

/* Mobile improvements now handled by consolidated responsive system above */

.loadout-screen .header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
  padding: 20px;
  background: rgba(8, 12, 20, 0.8);
  border-radius: 16px;
  border: 1px solid #1f2a3a;
}

.loadout-screen h1 {
  margin: 0;
  font-size: 28px;
  font-weight: 700;
  color: #f8fafc;
}

.slot-counter {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 18px;
  font-weight: 600;
}

.slots-used {
  color: #3b82f6;
  font-size: 24px;
}

.slots-separator {
  color: #6b7280;
}

.slots-total {
  color: #f8fafc;
  font-size: 24px;
}

.slots-label {
  color: #9ca3af;
  font-size: 14px;
  margin-left: 8px;
}

.instructions {
  text-align: center;
  margin-bottom: 30px;
  color: #9ca3af;
  font-size: 16px;
}

.abilities-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.ability-card {
  background: #0e1420;
  border: 2px solid #1f2a3a;
  border-radius: 16px;
  padding: 12px 20px;
  cursor: pointer;
  transition: all 0.2s ease;
  position: relative;
  display: flex;
  flex-direction: column;
  gap: 12px;
  min-height: 100px;
}

.ability-card:hover:not(.is-disabled) {
  border-color: #3b82f6;
  background: #1a2332;
  transform: translateY(-2px);
  box-shadow: 0 8px 32px rgba(59, 130, 246, 0.2);
}

.ability-card.is-selected {
  border-color: #10b981;
  background: #064e3b;
  box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
}

/* Ensure selected ability cards don't overflow */
.ability-card--mobile.is-selected {
  border-color: #3b82f6;
  background: #0f1a2e;
  box-shadow: 0 0 0 3px rgba(59,130,246,.15);
  /* Ensure the blue ring doesn't extend beyond the card boundaries */
  margin: 4px;
  transform: translateY(-1px);
}

.ability-card.is-disabled {
  opacity: 0.5;
  cursor: not-allowed;
  background: #1a1a1a;
}

.ability-card.is-disabled:hover {
  transform: none;
  box-shadow: none;
}

.ability-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 6px;
}

.ability-name {
  font-size: 18px;
  font-weight: 700;
  color: #f8fafc;
  margin: 0;
}

.ability-role {
  font-size: 12px;
  color: #9ca3af;
  background: #1c2433;
  padding: 4px 8px;
  border-radius: 6px;
  border: 1px solid #2a3650;
}

.ability-type {
  display: inline-block;
  padding: 6px 12px;
  border-radius: 8px;
  font-size: 12px;
  font-weight: 600;
  text-transform: uppercase;
  margin-bottom: 12px;
}

.ability-type--kinetic {
  background: #1e293b;
  color: #94a3b8;
  border: 1px solid #475569;
  box-shadow: 0 0 8px rgba(148, 163, 184, 0.2);
}

.ability-type--arc {
  background: #0e223b;
  color: #9cd2ff;
  border: 1px solid #245a9b;
  box-shadow: 0 0 8px rgba(156, 210, 255, 0.2);
}

.ability-type--thermal {
  background: #3a1a10;
  color: #ffb38a;
  border: 1px solid #7a3a1c;
  box-shadow: 0 0 8px rgba(255, 179, 138, 0.2);
}

.ability-type--void {
  background: #2e1b4e;
  color: #c4b5fd;
  border: 1px solid #5b21b6;
  box-shadow: 0 0 8px rgba(196, 181, 253, 0.2);
}

.ability-stats {
  display: flex;
  gap: 8px;
  margin-bottom: 8px;
  flex-wrap: wrap;
  align-items: center;
}

.stat {
  background: #1c2433;
  color: #c9d3e7;
  padding: 2px 6px;
  font-size: 11px;
  white-space: nowrap;
  border-radius: 6px;
  font-weight: 600;
  border: 1px solid #2a3650;
  display: flex;
  align-items: center;
  gap: 4px;
}

.ability-description {
  color: #9ca3af;
  font-size: 14px;
  line-height: 1.4;
  margin-top: 4px;
  margin-bottom: 0;
}

.action-bar {
  display: flex;
  justify-content: center;
  gap: 20px;
  padding: 20px;
}

.btn--secondary {
  background: #374151;
  color: #f8fafc;
  border: 1px solid #4b5563;
}

.btn--secondary:hover:not(:disabled) {
  background: #4b5563;
  border-color: #6b7280;
}

/* Mobile responsiveness now handled by consolidated responsive system above */

/* === LOADOUT SCREEN ENHANCEMENTS === */

.loadout-filters {
  background: rgba(8, 12, 20, 0.6);
  border: 1px solid #1f2a3a;
  border-radius: 12px;
  padding: 16px;
  margin: 16px 0;
  backdrop-filter: blur(8px);
}

/* Weapon grid styling */
.weapon-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 10px;
  padding: 0 2px;
  width: 100%;
  box-sizing: border-box;
}

.weapon-card {
  background: #0e1420;
  border: 1px solid #1f2a3a;
  border-radius: 10px;
  padding: 12px;
  min-height: 56px;
  display: flex;
  flex-direction: column;
  gap: 4px;
  cursor: pointer;
  transition: all 0.2s ease;
  touch-action: manipulation;
  width: 100%;
  box-sizing: border-box;
}

.weapon-card:hover {
  border-color: #374151;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.weapon-card:active {
  transform: translateY(1px);
}

.weapon-card.is-selected {
  border-color: #3b82f6;
  background: rgba(59, 130, 246, 0.1);
  box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
}

.weapon-card:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  background: #1f2937;
}

.weapon-header {
  display: flex;
  flex-direction: column;
  gap: 3px;
}

.weapon-name {
  font-size: 13px;
  font-weight: 600;
  color: #f8fafc;
  line-height: 1.2;
}

.weapon-role {
  font-size: 10px;
  color: #94a3b8;
  opacity: 0.7;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.weapon-effect {
  font-size: 11px;
  color: #cbd5e1;
  line-height: 1.3;
  flex: 1;
}

/* Responsive improvements now handled by consolidated responsive system above */

/* Section headers */
.section-header {
  font-size: 16px;
  font-weight: 600;
  color: #e2e8f0;
  margin-bottom: 12px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Toast styling */
.toast-container {
  position: fixed;
  left: 16px;
  right: 16px;
  bottom: calc(200px + env(safe-area-inset-bottom));
  display: flex;
  justify-content: center;
  pointer-events: none;
  z-index: 100;
}

.toast {
  background: rgba(8, 12, 20, 0.95);
  border: 1px solid #1f2a3a;
  border-radius: 8px;
  padding: 8px 16px;
  color: #f8fafc;
  font-size: 14px;
  font-weight: 500;
  backdrop-filter: blur(8px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  pointer-events: auto;
}

/* Character info styling */
.character-info {
  display: flex;
  align-items: center;
  gap: 12px;
  min-width: 0;
  flex: 1;
}

.character-icon {
  width: 48px;
  height: 48px;
  border-radius: 12px;
  flex-shrink: 0;
  border: 2px solid #1f2a3a;
}

.character-details {
  display: flex;
  flex-direction: column;
  gap: 2px;
  min-width: 0;
  flex: 1;
}

.character-name {
  font-size: 16px;
  font-weight: 800;
  color: #f8fafc;
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
}

.character-stats {
  display: flex;
  align-items: center;
  gap: 8px;
}

.equipped-label {
  font-size: 12px;
  color: #94a3b8;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-weight: 600;
}

.equipped-count {
  font-size: 14px;
  font-weight: 700;
  color: #3b82f6;
}

/* Footer button improvements */
.footer-button {
  min-height: 56px;
  font-size: 16px;
  font-weight: 600;
  padding: 12px 16px;
  border-radius: 12px;
  transition: all 0.2s ease;
  touch-action: manipulation;
}

.footer-button:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.footer-button:active {
  transform: translateY(0);
}

.nav-button {
  min-height: 56px;
  font-size: 20px;
  font-weight: 700;
  padding: 12px 16px;
  border-radius: 12px;
  transition: all 0.2s ease;
  touch-action: manipulation;
}

.nav-button:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.nav-button:active {
  transform: translateY(0);
}

/* Button styling now handled by consolidated system above */

/* Responsive improvements now handled by consolidated responsive system above */

/* Safe area support for modern mobile devices */
@supports (padding: max(0px)) {
  .loadout-wrap {
    padding-bottom: max(200px, calc(200px + env(safe-area-inset-bottom)));
  }
  
  .sticky-footer {
    padding-bottom: max(12px, calc(12px + env(safe-area-inset-bottom)));
  }
  
  .toast-container {
    bottom: max(220px, calc(220px + env(safe-area-inset-bottom)));
  }
}

/* === LOADOUT MOBILE-FIRST HEADER, CARDS, NAV, FOOTER === */
.loadout-fixed-header {
  position: sticky;
  top: 0;
  z-index: 50;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  padding: 12px;
  background: rgba(8, 12, 20, 0.9);
  backdrop-filter: blur(8px);
}

.lfh-left { display: flex; flex-direction: column; gap: 4px; }
.lfh-label { font-size: 12px; color: #94a3b8; text-transform: uppercase; letter-spacing: .5px; font-weight: 700; }
.lfh-name { font-size: 18px; font-weight: 800; color: #f8fafc; }
.lfh-class { color: #a78bfa; font-weight: 700; }
.lfh-sub { display: flex; align-items: center; gap: 8px; }
.lfh-slots { font-size: 12px; color: #cbd5e1; opacity: .85; }
.ghost-btn { background: #0f1624; border-color: #1f2a3a; }

.slot-dots { display: inline-flex; gap: 6px; align-items: center; }
.slot-dot { width: 10px; height: 10px; border-radius: 50%; background: #1f2a3a; border: 1px solid #334155; display: inline-block; }
.slot-dot.is-filled { background: #22c55e; border-color: #16a34a; }

.party-selector { display: flex; gap: 8px; overflow-x: auto; padding: 12px; }
.party-chip { min-height: 44px; padding: 8px 12px; border-radius: 999px; border: 1px solid #1f2a3a; background: #0f1624; color: #e6ecf1; font-weight: 700; display: inline-flex; gap: 8px; align-items: baseline; white-space: nowrap; }
.party-chip.is-active { background: #1e293b; border-color: #334155; box-shadow: 0 0 0 3px rgba(59,130,246,.15) inset; }
.party-chip .chip-name { font-size: 13px; }
.party-chip .chip-class { font-size: 11px; opacity: .8; color: #94a3b8; }

/* Duplicate rule removed - handled above */

/* Webkit scrollbar styling for better UX */
.ability-grid.ability-grid--mobile::-webkit-scrollbar {
  height: 6px; /* Slightly taller for better touch interaction */
}

.ability-grid.ability-grid--mobile::-webkit-scrollbar-track {
  background: rgba(31, 42, 58, 0.4);
  border-radius: 3px;
}

.ability-grid.ability-grid--mobile::-webkit-scrollbar-thumb {
  background: rgba(148, 163, 184, 0.6);
  border-radius: 3px;
}

.ability-grid.ability-grid--mobile::-webkit-scrollbar-thumb:hover {
  background: rgba(148, 163, 184, 0.8);
}

.ability-card--mobile { 
  background: #0e1420; 
  border: 1px solid #1f2a3a; 
  border-radius: 12px; 
  padding: 0; /* Remove padding since the button handles it */
  overflow: visible; /* Allow selection ring to show */
  min-height: 84px; /* Reduced height since button handles padding */
  height: 84px;
  min-width: 280px; /* Ensure cards don't get too narrow */
  flex-shrink: 0; /* Prevent cards from shrinking */
  display: flex; 
  flex-direction: column; 
  gap: 0; /* No gap needed */
  margin: 0 2px; /* Increased margin to accommodate selection ring */
  transition: all 0.2s ease;
  touch-action: manipulation;
}

.ability-card--mobile:hover {
  border-color: #374151;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.ability-card--mobile:active {
  transform: translateY(1px);
}

/* Sustain cards: balanced vertical rhythm */
.ability-card--sustain { 
  padding-top: 16px; /* Increased from 3px */
  padding-bottom: 16px; /* Increased from 4px */
  gap: 12px; /* Increased from 6px for better spacing */
}

.ability-summary-row { 
  display: flex; 
  align-items: center; 
  gap: 12px; /* Increased from 6px */
  justify-content: space-between; 
  padding: 0; /* Reduced from 4px for tighter spacing */
  min-height: 40px; /* Ensure consistent height */
  width: 100%; /* Take full width */
}

.ability-card--mobile .ability-toggle { 
  all: unset; 
  display: flex; 
  align-items: center; 
  gap: 16px; /* Increased gap for better spacing */
  min-height: 60px; /* Increased height to accommodate stacked content */
  cursor: pointer;
  width: 100%; /* Take full width */
  justify-content: space-between; /* Distribute space evenly */
  transition: all 0.2s ease;
  touch-action: manipulation;
  padding: 12px;
  border-radius: 8px;
}

.ability-card--mobile .ability-toggle:hover {
  background: rgba(31, 41, 55, 0.3);
  border-radius: 8px;
}

.ability-card--mobile .ability-toggle:active {
  background: rgba(31, 41, 55, 0.5);
}



/* New structure for ability toggle */
.ability-left-content {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.ability-title-row {
  display: flex;
  align-items: baseline;
  gap: 4px;
  flex-wrap: wrap;
}

.ability-title {
  font-size: 16px;
  font-weight: 700;
  color: #f8fafc;
  line-height: 1.2;
  white-space: nowrap;
}

.ability-description {
  font-size: 12px;
  color: #94a3b8;
  line-height: 1.3;
  white-space: nowrap;
}

.ability-right-content {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 8px;
  flex-shrink: 0;
}

.ability-stats {
  display: flex;
  gap: 8px;
  font-size: 11px;
  color: #94a3b8;
}

.dt-icon { 
  width: 14px; 
  height: 14px; 
  border-radius: 50%; 
  display: inline-block; 
  flex-shrink: 0;
}

/* Left section of ability toggle (icon + name) */
.ability-toggle-left {
  display: flex;
  align-items: center;
  gap: 8px;
  flex: 1;
  min-width: 0;
}

/* Right section of ability toggle (role + element) */
.ability-toggle-right {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-shrink: 0;
}

.dt-icon--thermal { background: #ef4444; }
.dt-icon--arc { background: #3b82f6; }
.dt-icon--void { background: #a78bfa; }
.dt-icon--kinetic { background: #6b7280; }

.ability-name { 
  font-size: 15px; 
  font-weight: 700; 
  color: #f8fafc;
  flex: 1; /* Allow name to expand */
  min-width: 0; /* Allow shrinking */
  overflow: visible; /* Allow full text to show */
  white-space: normal; /* Allow text to wrap */
  word-wrap: break-word; /* Break long words if needed */
  line-height: 1.2; /* Tighter line height for wrapped text */
}

.role-badge { 
  font-size: 10px; 
  font-weight: 600;
  padding: 2px 6px;
  border-radius: 4px;
  white-space: nowrap;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Mobile-specific improvements for very small screens */
@media (max-width: 360px) {
  .ability-card--mobile {
    padding: 12px;
    gap: 10px;
  }
  
  .ability-toggle {
    min-height: 52px;
    padding: 8px;
  }
  
  .ability-title {
    font-size: 15px;
  }
  
  .ability-description {
    font-size: 11px;
  }
  
  .ability-toggle {
    gap: 8px;
    min-height: 36px;
  }
  
  .ability-name {
    font-size: 14px;
  }
  
  .role-badge {
    font-size: 9px;
    padding: 1px 4px;
  }
  
  .element-badge {
    font-size: 9px;
    padding: 1px 4px;
  }
}

/* Improve button states for mobile */
/* Button styling now handled by consolidated system above */

/* Additional ability card styling */
.ability-meta-row { 
  display: flex; 
  align-items: center; 
  justify-content: space-between; 
  gap: 12px; 
  overflow: visible;
}

.ability-meta { 
  display: flex; 
  align-items: center; 
  flex-wrap: wrap; 
  gap: 6px; 
  overflow: visible;
  margin-bottom: 8px;
}

.stat-compact { 
  font-size: 11px; 
  color: #94a3b8;
  max-width: 80px; /* Constrain width */
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  display: inline-block;
  flex-shrink: 0; /* Prevent shrinking */
  font-weight: 600;
}

.role--prime { color: #9cd2ff; border-color: #245a9b; }
.role--detonator { color: #ffb38a; border-color: #7a3a1c; }
.role--sustain { color: #a78bfa; border-color: #5b21b6; }

/* Loadout section styling */
.loadout-sub {
  font-size: 16px;
  font-weight: 600;
  color: #e2e8f0;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 12px;
}

/* Slot requirements styling */
.slot-requirements {
  background: rgba(15, 23, 42, 0.6);
  border: 1px solid #334155;
  border-radius: 12px;
  padding: 16px;
  margin: 16px 0;
}

.slot-requirements h4 {
  color: #e2e8f0;
  font-size: 14px;
  font-weight: 600;
  margin: 0 0 12px 0;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.slot-requirement-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.slot-requirement {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 12px;
  border-radius: 8px;
  border: 1px solid;
  transition: all 0.2s ease;
}

.slot-requirement.is-filled {
  background: rgba(34, 197, 94, 0.1);
  border-color: #22c55e;
  color: #22c55e;
}

.slot-requirement.is-empty {
  background: rgba(239, 68, 68, 0.1);
  border-color: #ef4444;
  color: #ef4444;
}

.requirement-label {
  font-weight: 600;
  font-size: 13px;
}

.requirement-status {
  font-size: 12px;
  font-weight: 500;
}

/* === IPHONE VIEWPORT FIXES === */
/* Force all screens to fit within iPhone viewport */
html, body, #app, #app-wrap {
  width: 100vw;
  max-width: 100vw;
  overflow-x: hidden;
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

/* Ensure the app container itself is constrained */
#app {
  width: 100%;
  max-width: 100vw;
  height: 100vh;
  overflow: hidden;
  position: relative;
}

/* iPhone specific overrides */
@media screen and (max-width: 428px) {
  html, body, #app, #app-wrap {
    width: 100vw;
    max-width: 100vw;
    overflow-x: hidden;
  }
  
  /* Force all content to be smaller */
  * {
    max-width: 100vw;
    box-sizing: border-box;
  }
  
  /* Ensure no element can exceed viewport */
  .loadout-screen,
  .battle-screen,
  .party-screen,
  .missions-screen,
  .welcome-screen {
    width: 100vw;
    max-width: 100vw;
    overflow-x: hidden;
    padding-left: max(12px, env(safe-area-inset-left));
    padding-right: max(12px, env(safe-area-inset-right));
    padding-top: max(12px, env(safe-area-inset-top));
    padding-bottom: max(12px, env(safe-area-inset-bottom));
  }
}

/* === BATTLE & PARTY SCREEN IPHONE FIXES === */
/* Ensure all game screens fit within iPhone viewport */
.battle-screen,
.party-screen,
.missions-screen,
.welcome-screen {
  width: 100vw;
  max-width: 100vw;
  overflow-x: hidden;
  box-sizing: border-box;
}

/* iPhone specific screen constraints */
@media screen and (max-width: 428px) {
  .battle-screen,
  .party-screen,
  .missions-screen,
  .welcome-screen {
    padding-left: max(6px, env(safe-area-inset-left));
    padding-right: max(6px, env(safe-area-inset-right));
    padding-top: max(6px, env(safe-area-inset-top));
    padding-bottom: max(6px, env(safe-area-inset-bottom));
  }
  
  /* Force all content to be smaller on iPhone */
  .battle-screen *,
  .party-screen *,
  .missions-screen *,
  .welcome-screen * {
    max-width: 100vw;
    box-sizing: border-box;
  }
  
  /* Reduce font sizes for iPhone */
  .battle-screen h1,
  .party-screen h1,
  .missions-screen h1,
  .welcome-screen h1 {
    font-size: 20px;
  }
  
  .battle-screen h2,
  .party-screen h2,
  .missions-screen h2,
  .welcome-screen h2 {
    font-size: 18px;
  }
  
  .battle-screen h3,
  .party-screen h3,
  .missions-screen h3,
  .welcome-screen h3 {
    font-size: 16px;
  }
  
  /* Button sizes now handled by consolidated system above */
  
  /* Card padding now handled by consolidated system above */
  
  /* Reduce margins and gaps for iPhone */
  .battle-screen .section,
  .party-screen .section,
  .missions-screen .section,
  .welcome-screen .section {
    margin-bottom: 12px;
  }
  
  .battle-screen .row,
  .party-screen .row,
  .missions-screen .row,
  .welcome-screen .row {
    gap: 8px;
  }
}

/* Extra small iPhone fixes */
@media screen and (max-width: 375px) {
  .battle-screen,
  .party-screen,
  .missions-screen,
  .welcome-screen {
    padding-left: max(4px, env(safe-area-inset-left));
    padding-right: max(4px, env(safe-area-inset-right));
    padding-top: max(4px, env(safe-area-inset-top));
    padding-bottom: max(4px, env(safe-area-inset-bottom));
  }
  
  /* Button sizes now handled by consolidated system above */
  
  /* Card padding now handled by consolidated system above */
}

/* === PARTY SCREEN MOBILE FIXES === */
.party-screen {
  width: 100vw;
  max-width: 100vw;
  overflow-x: hidden;
}

.party-screen .mx-auto {
  width: 100vw;
  max-width: 100vw;
  overflow-x: hidden;
}

.card-grid {
  width: 100%;
  overflow-x: hidden;
  padding: 0 8px;
}

/* === BATTLE SCREEN CHAR-CARD STYLING === */
/* Battle-specific styling for char-cards in battle screen */
.battle-char-card {
  /* Override some party select styles for battle context */
  grid-template-columns: 48px 1fr auto;
  min-height: 56px;
  padding: 8px 8px;
  gap: 6px;
}

/* Character info centered under icon */
.battle-char-card .char-icon {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  width: 48px;
  flex-shrink: 0;
}

.battle-char-card .char-info {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
  width: 100%;
  text-align: center;
}

.battle-char-card .char-name {
  font-size: 10px;
  font-weight: 600;
  color: #f8fafc;
  line-height: 1.2;
  white-space: normal;
  word-wrap: break-word;
  text-align: center;
  max-width: 44px;
  min-height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.battle-char-card .class-badge {
  font-size: 8px;
  font-weight: 700;
  padding: 2px 4px;
  border-radius: 3px;
  background: rgba(15, 23, 42, 0.8);
  border: 1px solid rgba(148, 163, 184, 0.3);
  white-space: nowrap;
  text-align: center;
  min-width: 24px;
  min-height: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Battle char-card mobile adjustments */
@media (max-width: 428px) {
  .battle-char-card {
    grid-template-columns: 40px 1fr auto;
    min-height: 48px;
    padding: 6px 6px;
    gap: 4px;
  }
  
  .battle-char-card .char-icon {
    width: 40px;
    gap: 3px;
  }
  
  .battle-char-card .char-name {
    font-size: 9px;
    max-width: 36px;
    min-height: 20px;
  }
  
  .battle-char-card .class-badge {
    font-size: 7px;
    padding: 1px 2px;
    min-width: 20px;
    min-height: 14px;
  }
  
  .battle-char-card .stat-row {
    font-size: 9px;
    gap: 3px;
  }
  
  .battle-char-card .stat {
    padding: 1px 2px;
    font-size: 9px;
  }
  
  .battle-char-card .super-bar {
    height: 6px;
    margin: 1px 0;
  }
  
  .battle-char-card .loadout-sub {
    font-size: 8px;
  }
  
  .battle-char-card .super-btn {
    min-height: 28px;
    padding: 3px 6px;
    font-size: 9px;
  }
}

@media (max-width: 375px) {
  .battle-char-card {
    grid-template-columns: 36px 1fr auto;
    min-height: 44px;
    padding: 4px 4px;
    gap: 3px;
  }
  
  .battle-char-card .char-icon {
    width: 36px;
    gap: 2px;
  }
  
  .battle-char-card .char-name {
    font-size: 8px;
    max-width: 32px;
    min-height: 18px;
  }
  
  .battle-char-card .class-badge {
    font-size: 6px;
    padding: 1px 2px;
    min-width: 18px;
    min-height: 12px;
  }
  
  .battle-char-card .stat-row {
    font-size: 8px;
    gap: 2px;
  }
  
  .battle-char-card .stat {
    padding: 1px 2px;
    font-size: 8px;
  }
  
  .battle-char-card .super-bar {
    height: 5px;
    margin: 1px 0;
  }
  
  .battle-char-card .loadout-sub {
    font-size: 7px;
  }
  
  .battle-char-card .super-btn {
    min-height: 24px;
    padding: 2px 4px;
    font-size: 8px;
  }
}

.super-btn {
  min-height: 32px;
  padding: 4px 8px;
  border-radius: 6px;
  border: 1px solid #f59e0b;
  background: linear-gradient(90deg, #fbbf24, #f59e0b);
  color: #111;
  font-weight: 700;
  cursor: pointer;
  font-size: 10px;
  white-space: nowrap;
  box-shadow: 0 2px 8px rgba(251, 191, 36, 0.3);
  transition: all 0.2s ease;
}

.super-btn:hover {
  background: linear-gradient(90deg, #f59e0b, #d97706);
  box-shadow: 0 4px 12px rgba(251, 191, 36, 0.4);
  transform: translateY(-1px);
}

.super-btn:active {
  transform: translateY(0);
}

/* === CONSOLIDATED RESPONSIVE SYSTEM === */
/* 
  This section consolidates all responsive styles into organized breakpoints.
  Previously these were scattered throughout the file with !important declarations.
*/

/* Large screens (desktop) */
@media (min-width: 1024px) {
  .card {
    padding: 16px;
    margin-bottom: 16px;
  }
  
  .ability {
    padding: 14px;
    min-height: 110px;
  }
  
  .btn {
    min-height: 48px;
    padding: 12px 18px;
    font-size: 15px;
  }
}

/* Medium screens (tablet) */
@media (max-width: 1023px) and (min-width: 769px) {
  .card {
    padding: 14px;
    margin-bottom: 14px;
  }
  
  .ability {
    padding: 12px;
    min-height: 100px;
  }
  
  .btn {
    min-height: 44px;
    padding: 10px 16px;
    font-size: 14px;
  }
}

/* Small screens (mobile) */
@media (max-width: 768px) {
  .card {
    padding: 12px;
    margin-bottom: 12px;
  }
  
  .ability {
    padding: 10px;
    min-height: 90px;
  }
  
  .btn {
    min-height: 40px;
    padding: 8px 12px;
    font-size: 13px;
  }
  
  .action-footer {
    padding: 12px max(12px, env(safe-area-inset-left)) 12px max(12px, env(safe-area-inset-right));
    padding-bottom: max(12px, calc(12px + env(safe-area-inset-bottom)));
  }
  
  .loadout-content {
    padding-bottom: 180px;
  }
}

/* Extra small screens (mobile) */
@media (max-width: 480px) {
  .card {
    padding: 10px;
    margin-bottom: 10px;
  }
  
  .ability {
    padding: 8px;
    min-height: 80px;
  }
  
  .btn {
    min-height: 36px;
    padding: 6px 10px;
    font-size: 12px;
  }
  
  .action-footer {
    padding: 10px max(8px, env(safe-area-inset-left)) 10px max(8px, env(safe-area-inset-right));
    padding-bottom: max(10px, calc(10px + env(safe-area-inset-bottom)));
  }
  
  .footer-actions {
    gap: 8px;
  }
  
  .ability-card--compact {
    padding: 8px;
  }
}

/* iPhone specific (very small screens) */
@media (max-width: 428px) {
  .card {
    padding: 8px;
    margin-bottom: 8px;
  }
  
  .ability {
    padding: 6px;
    min-height: 70px;
  }
  
  .btn {
    min-height: 32px;
    padding: 5px 8px;
    font-size: 11px;
  }
  
  .action-footer {
    padding: 8px max(6px, env(safe-area-inset-left)) 8px max(6px, env(safe-area-inset-right));
    padding-bottom: max(8px, calc(8px + env(safe-area-inset-bottom)));
  }
  
  .footer-actions {
    gap: 6px;
  }
  
  .ability-card--compact {
    padding: 6px;
  }
  
  /* iPhone screen constraints */
  .battle-screen,
  .party-screen,
  .missions-screen,
  .welcome-screen {
    padding-left: max(6px, env(safe-area-inset-left));
    padding-right: max(6px, env(safe-area-inset-right));
    padding-top: max(6px, env(safe-area-inset-top));
    padding-bottom: max(6px, env(safe-area-inset-bottom));
  }
  
  /* iPhone typography */
  .battle-screen h1,
  .party-screen h1,
  .missions-screen h1,
  .welcome-screen h1 {
    font-size: 20px;
  }
  
  .battle-screen h2,
  .party-screen h2,
  .missions-screen h2,
  .welcome-screen h2 {
    font-size: 18px;
  }
  
  .battle-screen h3,
  .party-screen h3,
  .missions-screen h3,
  .welcome-screen h3 {
    font-size: 16px;
  }
  
  /* iPhone spacing */
  .battle-screen .section,
  .party-screen .section,
  .missions-screen .section,
  .welcome-screen .section {
    margin-bottom: 12px;
  }
  
  .battle-screen .row,
  .party-screen .row,
  .missions-screen .row,
  .welcome-screen .row {
    gap: 8px;
  }
}

/* Extra small iPhone */
@media (max-width: 375px) {
  .battle-screen,
  .party-screen,
  .missions-screen,
  .welcome-screen {
    padding-left: max(4px, env(safe-area-inset-left));
    padding-right: max(4px, env(safe-area-inset-right));
    padding-top: max(4px, env(safe-area-inset-top));
    padding-bottom: max(4px, env(safe-area-inset-bottom));
  }
}

/* Touch device optimizations */
@media (pointer: coarse) {
  .btn {
    min-height: 44px;
  }
  
  .btn--compact {
    min-height: 40px;
  }
  
  .ability-toggle {
    min-height: 36px;
  }
  
  .ability-card--mobile {
    padding: 12px;
  }
  
  .ability-card--compact {
    min-height: 44px;
  }
}

/* Landscape orientation adjustments */
@media (orientation: landscape) and (max-height: 600px) {
  .action-footer {
    min-height: 120px;
    padding: 12px max(12px, env(safe-area-inset-left)) 12px max(12px, env(safe-area-inset-right));
    padding-bottom: max(12px, calc(12px + env(safe-area-inset-bottom)));
  }
  
  .loadout-content {
    padding-bottom: 140px;
  }
}

/* Force super bar visibility */
#app .char-card .super-bar,
.party-screen .char-card .super-bar,
.char-card .super-bar {
  position: relative;
  height: 12px;
  border-radius: 4px;
  background: rgba(148, 163, 184, 0.15);
  margin: 4px 0;
  overflow: hidden;
  border: 1px solid rgba(148, 163, 184, 0.3);
  min-height: 12px;
  display: block;
  visibility: visible;
  opacity: 1;
}

#app .char-card .super-segments,
.party-screen .char-card .super-segments,
.char-card .super-segments {
  display: flex;
  gap: 2px;
  height: 100%;
  padding: 1px;
}

#app .char-card .super-segment,
.party-screen .char-card .super-segment,
.char-card .super-segment {
  flex: 1;
  border-radius: 2px;
  background: rgba(148, 163, 184, 0.2);
  transition: background 0.3s ease;
  min-height: 8px;
}

/* Override any full-width behavior for class pills on mobile */
@media (max-width: 480px) {
  .stat:first-child {
    max-width: fit-content !important;
    min-width: fit-content !important;
  }
}

@media (max-width: 428px) {
  .stat:first-child {
    max-width: fit-content !important;
    min-width: fit-content !important;
  }
}

/* Override any full-width behavior for class pills on mobile */
@media (max-width: 480px) {
  .class-pill .stat {
    max-width: fit-content !important;
    min-width: fit-content !important;
  }
}

@media (max-width: 428px) {
  .class-pill .stat {
    max-width: fit-content !important;
    min-width: fit-content !important;
  }
}

/* Ensure abilities container has proper scroll behavior */
#abilities .ability-tray,
.ability-tray {
  display: grid !important;
  grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  grid-template-rows: repeat(3, 84px) !important;
  gap: 8px !important;
  padding: 2px 12px 12px 12px !important;
  height: 252px !important; /* 3 rows  84px + padding */
  max-height: 252px !important;
  overflow-y: scroll !important;
  -webkit-overflow-scrolling: touch !important;
  scroll-behavior: smooth !important;
  scrollbar-width: thin !important;
  scrollbar-color: rgba(148, 163, 184, 0.3) transparent !important;
  /* Force scrollbar to always be visible for testing */
  overflow-y: scroll !important;
}

/* Abilities section - container for ability tray */
#abilities {
  position: relative !important;
  z-index: 5 !important;
  height: 252px !important; /* Updated for 2x3 grid */
  padding: 6px !important;
  margin: 6px !important;
  margin-top: 4px !important;
  background: rgba(15, 23, 42, 0.8) !important;
  border-radius: 8px !important;
  border: 1px solid rgba(148, 163, 184, 0.2) !important;
  /* Ensure proper sizing for scrolling */
  box-sizing: border-box !important;
  overflow: hidden !important;
}

/* Main content area with proper spacing for fixed footer */
.main {
  position: relative !important;
  z-index: 1 !important;
  height: calc(100vh - 70px) !important;
  padding-bottom: 60px !important;
  display: block !important;
  overflow: hidden !important;
}

/* AOE badge styling */
.aoe-badge {
  background: linear-gradient(135deg, #ff6b35, #f7931e);
  color: white;
  font-size: 10px;
  font-weight: 700;
  padding: 2px 6px;
  border-radius: 10px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  box-shadow: 0 2px 4px rgba(255, 107, 53, 0.3);
  margin-left: 8px;
  white-space: nowrap;
  display: inline-block;
  line-height: 1.2;
}

/* Selected ability styling with AOE badge support */
.selected-ability {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  background: rgba(59, 130, 246, 0.1);
  border: 1px solid rgba(59, 130, 246, 0.3);
  border-radius: 8px;
  margin-bottom: 8px;
}

.selected-ability .ability-name {
  font-weight: 600;
  color: #f8fafc;
  flex: 1;
}

.selected-ability .aoe-badge {
  margin-left: 4px;
  margin-right: 4px;
  font-size: 9px;
  padding: 1px 4px;
}

/* Battle screen AOE indicator styling */
.ability .ability-name {
  display: flex;
  align-items: center;
  gap: 4px;
}

.ability .aoe-indicator {
  color: #ff6b35;
  font-weight: 700;
  font-size: 12px;
}

/* === WEAPON ELEMENT STYLES === */
.weapon-element {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 6px 10px;
  font-size: 12px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border-radius: 6px;
  border: 1px solid;
  white-space: nowrap;
  line-height: 1;
  margin-top: auto;
  align-self: flex-end;
}

.weapon-element--kinetic {
  background: rgba(148, 163, 184, 0.8);
  color: #1e293b;
  border-color: rgba(148, 163, 184, 0.6);
}

.weapon-element--arc {
  background: rgba(56, 189, 248, 0.8);
  color: #0c4a6e;
  border-color: rgba(56, 189, 248, 0.6);
}

.weapon-element--thermal {
  background: rgba(239, 68, 68, 0.8);
  color: #7f1d1d;
  border-color: rgba(239, 68, 68, 0.6);
}

.weapon-element--void {
  background: rgba(168, 85, 247, 0.8);
  color: #581c87;
  border-color: rgba(168, 85, 247, 0.6);
}

/* Weapon selection UI styles */
.weapon-selection {
  margin: 16px 0;
  padding: 16px;
  background: rgba(15, 23, 42, 0.6);
  border-radius: 8px;
  border: 1px solid rgba(148, 163, 184, 0.2);
}

.weapon-selection h4 {
  margin: 0 0 12px 0;
  color: #e2e8f0;
  font-size: 14px;
  font-weight: 600;
}

.weapon-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 8px;
}

.weapon-option {
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding: 12px;
  background: rgba(30, 41, 59, 0.8);
  border: 1px solid rgba(148, 163, 184, 0.3);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
  text-align: left;
  min-height: 120px;
  justify-content: space-between;
}

.weapon-option:hover {
  background: rgba(51, 65, 85, 0.9);
  border-color: rgba(148, 163, 184, 0.5);
  transform: translateY(-1px);
}

.weapon-option.is-selected {
  background: rgba(59, 130, 246, 0.2);
  border-color: rgba(59, 130, 246, 0.6);
  box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
}

.weapon-info {
  flex: 1;
}

.weapon-name {
  font-weight: 600;
  color: #f8fafc;
  margin-bottom: 4px;
}

.weapon-stats {
  font-size: 12px;
  color: #cbd5e1;
  line-height: 1.4;
}

/* Loadout-specific weapon element styles - higher specificity than battle styles */
.loadout-screen .weapon-element {
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  padding: 6px 10px !important;
  font-size: 12px !important;
  font-weight: 700 !important;
  text-transform: uppercase !important;
  letter-spacing: 0.5px !important;
  border-radius: 6px !important;
  border: 1px solid !important;
  white-space: nowrap !important;
  line-height: 1 !important;
  margin-top: auto !important;
  align-self: flex-end !important;
}

.loadout-screen .weapon-element--kinetic {
  background: rgba(148, 163, 184, 0.8) !important;
  color: #1e293b !important;
  border-color: rgba(148, 163, 184, 0.6) !important;
}

.loadout-screen .weapon-element--arc {
  background: rgba(56, 189, 248, 0.8) !important;
  color: #0c4a6e !important;
  border-color: rgba(56, 189, 248, 0.6) !important;
}

.loadout-screen .weapon-element--thermal {
  background: rgba(239, 68, 68, 0.8) !important;
  color: #7f1d1d !important;
  border-color: rgba(239, 68, 68, 0.6) !important;
}

.loadout-screen .weapon-element--void {
  background: rgba(168, 85, 247, 0.8) !important;
  color: #581c87 !important;
  border-color: rgba(168, 85, 247, 0.6) !important;
}
